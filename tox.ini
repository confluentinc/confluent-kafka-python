[tox]
envlist = flake8,py37,py38,py39,py310,py311,py312,py313

[testenv]
deps =
    -r requirements/requirements-tests-install.txt
    .
passenv =
    #http://tox.readthedocs.io/en/latest/config.html#confval-passenv=SPACE-SEPARATED-GLOBNAMES
    *
commands =
    # Early verification that module is loadable
    python -c 'import confluent_kafka ; print(confluent_kafka.version())'
    # Run tests (large timeout to allow docker image downloads)
    python -m pytest --timeout 600 --ignore=tmp-build {posargs}
    # See tests/README.md for additional notes on testing
    #python tests/integration/integration_test.py

[testenv:flake8]
deps = flake8
commands = flake8

[testenv:cover]
commands =
    # Install source with editable flag (-e) so that SonarQube can parse the coverage report.
    # Otherwise, the report shows source files located in site-packages, which SonarQube cannot find.
    # Example: ".tox/cover/lib/python3.11/site-packages/confluent_kafka/__init__.py"
    #   instead of "src/confluent_kafka/__init__.py"
    pip install -e .
    pytest {env:PYTESTARGS:} --cov confluent_kafka --cov-report term --cov-report html --cov-report xml \
        --cov-branch --junitxml=test-report.xml tests/ {posargs}

[pytest]
python_files = test_*
testpaths = tests
norecursedirs = tests/integration/*/java

[flake8]
exclude = venv*,.venv*,env,.env,.tox,.toxenv,.git,build,docs,tools,tmp-build,*_pb2.py,*tmp-KafkaCluster/*
max-line-length = 119
accept-encodings = utf-8
