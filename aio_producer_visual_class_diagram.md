# AIOProducer Visual Class Diagram

## Overview
This document presents a visual class diagram for the `confluent_kafka.aio.producer` module using ASCII art boxes and arrows for better clarity.

## ğŸ¯ Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    ğŸ”µ CORE ORCHESTRATION LAYER                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                                    â•‘         AIOProducer          â•‘
                                    â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘
                                    â•‘ - _loop: EventLoop           â•‘
                                    â•‘ - _producer: Producer        â•‘
                                    â•‘ - _callback_manager          â•‘
                                    â•‘ - _kafka_executor            â•‘
                                    â•‘ - _batch_processor           â•‘
                                    â•‘ - _buffer_timeout_manager    â•‘
                                    â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘
                                    â•‘ + async produce()            â•‘
                                    â•‘ + async flush()              â•‘
                                    â•‘ + async close()              â•‘
                                    â•‘ + get_callback_stats()       â•‘
                                    â•‘ + create_batches_preview()   â•‘
                                    â•‘ - _handle_user_callback()    â•‘
                                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                              â”‚
                                              â”‚ creates & orchestrates
                                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                     â”‚                                     â”‚
        â–¼                                     â–¼                                     â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ğŸŸ£ MESSAGE PROCESSING | ğŸŸ¢ KAFKA OPERATIONS | ğŸŸ  TIMEOUT                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ ProducerBatchProcessor â•‘        â•‘   KafkaBatchExecutor  â•‘        â•‘ BufferTimeoutManager    â•‘
â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘        â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘        â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘
â•‘ - _callback_manager    â•‘â—„â”€â”€â”€â”€â”€â”€â–ºâ•‘ - _producer: Producer â•‘        â•‘ - _batch_processor      â•‘
â•‘ - _kafka_executor      â•‘        â•‘ - _executor: ThreadEx â•‘        â•‘ - _kafka_executor       â•‘
â•‘ - _message_buffer[]    â•‘        â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘        â•‘ - _timeout: float       â•‘
â•‘ - _buffer_futures[]    â•‘        â•‘ + async execute_batch â•‘        â•‘ - _timeout_task: Task   â•‘
â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘        â•‘   (topic, messages)   â•‘        â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘
â•‘ + add_message()        â•‘        â•‘ - _handle_partial_    â•‘        â•‘ + mark_activity()       â•‘
â•‘ + create_batches()     â•‘        â•‘   failures()          â•‘        â•‘ + start_monitoring()    â•‘
â•‘ + async flush_buffer() â•‘        â•‘                       â•‘        â•‘ + stop_monitoring()     â•‘
â•‘ + get_buffer_size()    â•‘        â•‘                       â•‘        â•‘ - async _monitor_timeoutâ•‘
â•‘ - _group_by_topic()    â•‘        â•‘                       â•‘        â•‘ - async _flush_timeout  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         â”‚                                   â”‚                              â”‚        â”‚
         â”‚ uses                              â”‚ executes batches             â”‚        â”‚
         â–¼                                   â–¼                              â”‚        â”‚
                                                                            â”‚        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                ğŸ”´ UNIFIED CALLBACK MANAGEMENT LAYER                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                            â”‚        â”‚
         â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                     â”‚        â”‚
         â•‘     CallbackManager       â•‘â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
         â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘                                              â”‚
         â•‘ - _loop: EventLoop        â•‘                                              â”‚
         â•‘ - _available: List[]      â•‘                                              â”‚
         â•‘ - _in_use: Set{}          â•‘                                              â”‚
         â•‘ - _created_count: int     â•‘                                              â”‚
         â•‘ - _reuse_count: int       â•‘                                              â”‚
         â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘                                              â”‚
         â•‘ + handle_user_callback()  â•‘                                              â”‚
         â•‘ + get_callback()          â•‘                                              â”‚
         â•‘ + return_callback()       â•‘                                              â”‚
         â•‘ + get_stats()             â•‘                                              â”‚
         â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                              â”‚
                    â”‚                                                               â”‚
                    â”‚ manages pool of                                               â”‚
                    â–¼                                                               â”‚
         â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                              â”‚
         â•‘ ReusableMessageCallback   â•‘                                              â”‚
         â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘                                              â”‚
         â•‘ + future: Future          â•‘                                              â”‚
         â•‘ + user_callback: callable â•‘                                              â”‚
         â•‘ + pool: CallbackManager   â•‘                                              â”‚
         â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘                                              â”‚
         â•‘ + reset()                 â•‘                                              â”‚
         â•‘ + __call__(err, msg)      â•‘                                              â”‚
         â•‘ - _clear_and_return()     â•‘                                              â”‚
         â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                              â”‚
                    â”‚                                                               â”‚
                    â”‚ auto-returns to pool                                          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
                                        â”‚                                          â”‚
                                        â–¼                                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                  ğŸŸ¡ DATA STRUCTURES LAYER                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚                                          â”‚
         â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—         â”‚
         â•‘      MessageBatch         â•‘  â”‚  â•‘   create_message_batch()   â•‘         â”‚
         â•‘    (namedtuple)           â•‘  â”‚  â•‘        (factory)           â•‘         â”‚
         â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘  â”‚  â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘         â”‚
         â•‘ + topic: str              â•‘  â”‚  â•‘ + create_message_batch()   â•‘         â”‚
         â•‘ + messages: tuple         â•‘â—„â”€â”¼â”€â”€â•‘   â†’ MessageBatch           â•‘         â”‚
         â•‘ + futures: tuple          â•‘  â”‚  â•‘                            â•‘         â”‚
         â•‘ + callbacks: tuple        â•‘  â”‚  â•‘ Ensures:                   â•‘         â”‚
         â•‘ + size: property          â•‘  â”‚  â•‘ â€¢ Type safety              â•‘         â”‚
         â•‘ + info: property          â•‘  â”‚  â•‘ â€¢ Immutability             â•‘         â”‚
         â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚  â•‘ â€¢ Validation               â•‘         â”‚
                    â–²                   â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•         â”‚
                    â”‚ creates           â”‚                                         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
                                                                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                  âšª EXTERNAL DEPENDENCIES                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                                  â”‚
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—      â”‚
    â•‘ confluent_kafka       â•‘    â•‘   ThreadPoolExecutor  â•‘    â•‘   asyncio.EventLoop     â•‘      â”‚
    â•‘   .Producer           â•‘    â•‘     (external)        â•‘    â•‘      (external)         â•‘      â”‚
    â•‘   (external)          â•‘    â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘    â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘      â”‚
    â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘    â•‘ + submit()            â•‘    â•‘ + call_soon_threadsafe()â•‘      â”‚
    â•‘ + produce_batch()     â•‘    â•‘ + shutdown()          â•‘    â•‘ + create_task()         â•‘      â”‚
    â•‘ + poll()              â•‘    â•‘                       â•‘    â•‘ + run_in_executor()     â•‘      â”‚
    â•‘ + flush()             â•‘    â•‘                       â•‘    â•‘                         â•‘      â”‚
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•      â”‚
             â–²                            â–²                            â–²                        â”‚
             â”‚                            â”‚                            â”‚                        â”‚
             â”‚ wraps & uses               â”‚ executes in                â”‚ schedules on           â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚                            â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Data Flow Diagram

```
User Code                    AIOProducer                 Internal Components
    â”‚                           â”‚                              â”‚
    â”‚ await produce()            â”‚                              â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                              â”‚
    â”‚                           â”‚ add_message()                â”‚
    â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ ProducerBatchProcessor
    â”‚                           â”‚                              â”‚        â”‚
    â”‚                           â”‚                              â”‚        â”‚ buffer fills up
    â”‚                           â”‚                              â”‚        â–¼
    â”‚                           â”‚                              â”‚ create_batches()
    â”‚                           â”‚                              â”‚        â”‚
    â”‚                           â”‚                              â”‚        â–¼ MessageBatch
    â”‚                           â”‚                              â”‚ execute_batch()
    â”‚                           â”‚                              â”‚        â”‚
    â”‚                           â”‚                              â”‚        â–¼ KafkaBatchExecutor
    â”‚                           â”‚                              â”‚ ThreadPoolExecutor.submit()
    â”‚                           â”‚                              â”‚        â”‚
    â”‚                           â”‚                              â”‚        â–¼
    â”‚                           â”‚                              â”‚ confluent_kafka.Producer
    â”‚                           â”‚                              â”‚   .produce_batch()
    â”‚                           â”‚                              â”‚        â”‚
    â”‚                           â”‚                              â”‚        â”‚ C thread callback
    â”‚                           â”‚                              â”‚        â–¼
    â”‚                           â”‚                              â”‚ ReusableMessageCallback
    â”‚                           â”‚                              â”‚   .__call__()
    â”‚                           â”‚                              â”‚        â”‚
    â”‚                           â”‚                              â”‚        â–¼
    â”‚                           â”‚                              â”‚ CallbackManager
    â”‚                           â”‚                              â”‚   .handle_user_callback()
    â”‚                           â”‚                              â”‚        â”‚
    â”‚                           â”‚                              â”‚        â”œâ”€ sync callback
    â”‚                           â”‚                              â”‚        â””â”€ async callback
    â”‚                           â”‚                              â”‚           (via event loop)
    â”‚                           â”‚                              â”‚
    â”‚ Future resolves           â”‚                              â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                              â”‚
    â”‚                           â”‚                              â”‚
```

## ğŸ“Š Component Relationships

### ğŸ”— Strong Composition (Creates & Owns)
```
AIOProducer
â”œâ”€â”€ creates â”€â”€â–º CallbackManager
â”œâ”€â”€ creates â”€â”€â–º KafkaBatchExecutor  
â”œâ”€â”€ creates â”€â”€â–º ProducerBatchProcessor
â””â”€â”€ creates â”€â”€â–º BufferTimeoutManager

CallbackManager
â””â”€â”€ manages pool of â”€â”€â–º ReusableMessageCallback[]
```

### ğŸ”Œ Dependency Injection (Loose Coupling)
```
ProducerBatchProcessor
â”œâ”€â”€ injected â”€â”€â–º CallbackManager
â””â”€â”€ injected â”€â”€â–º KafkaBatchExecutor

BufferTimeoutManager
â”œâ”€â”€ injected â”€â”€â–º ProducerBatchProcessor
â””â”€â”€ injected â”€â”€â–º KafkaBatchExecutor
```

### ğŸ“¦ Data Creation & Usage
```
ProducerBatchProcessor â”€â”€createsâ”€â”€â–º MessageBatch
ProducerBatchProcessor â”€â”€usesâ”€â”€â”€â”€â–º create_message_batch()
BufferTimeoutManager â”€â”€createsâ”€â”€â–º MessageBatch (via processor)
ReusableMessageCallback â”€â”€returns toâ”€â”€â–º CallbackManager
```

## ğŸ—ï¸ Architecture Benefits

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLEAN ARCHITECTURE                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  âœ… Single Responsibility    Each component has ONE job         â”‚
â”‚  âœ… Loose Coupling          Dependencies injected, not created  â”‚
â”‚  âœ… High Cohesion           Related code grouped together       â”‚
â”‚  âœ… Immutable Data          MessageBatch prevents corruption    â”‚
â”‚  âœ… Performance Optimized   Object pooling reduces allocations  â”‚
â”‚  âœ… Thread Safe             Proper C-thread to Python handling  â”‚
â”‚  âœ… Testable                Clean interfaces enable mocking     â”‚
â”‚  âœ… Maintainable            Changes isolated to single layer    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ˆ Performance Characteristics

### Memory Management
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              OBJECT POOLING                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  CallbackManager Pool:                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Available: [â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹]             â”‚        â”‚
â”‚  â”‚ In Use:    {â—â—â—}                    â”‚        â”‚
â”‚  â”‚ Created:   1000 total               â”‚        â”‚
â”‚  â”‚ Reused:    2500 times               â”‚        â”‚
â”‚  â”‚ Ratio:     2.5x reuse efficiency    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                 â”‚
â”‚  Benefits:                                      â”‚
â”‚  â€¢ Reduced GC pressure                         â”‚
â”‚  â€¢ Lower allocation overhead                   â”‚
â”‚  â€¢ Consistent performance                      â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Thread Safety Model
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              THREAD INTERACTION                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  Event Loop Thread (Python):                   â”‚
â”‚  â”œâ”€ Produces messages                           â”‚
â”‚  â”œâ”€ Manages buffer                              â”‚
â”‚  â””â”€ Schedules async callbacks                   â”‚
â”‚                                                 â”‚
â”‚  ThreadPool (Python):                          â”‚
â”‚  â”œâ”€ Executes produce_batch()                    â”‚
â”‚  â””â”€ Handles blocking operations                 â”‚
â”‚                                                 â”‚
â”‚  librdkafka (C threads):                       â”‚
â”‚  â”œâ”€ Network I/O                                â”‚
â”‚  â”œâ”€ Delivery confirmations                     â”‚
â”‚  â””â”€ Calls Python callbacks                     â”‚
â”‚                                                 â”‚
â”‚  Synchronization:                               â”‚
â”‚  â€¢ call_soon_threadsafe() for async callbacks  â”‚
â”‚  â€¢ Future objects for result communication     â”‚
â”‚  â€¢ No locks needed (GIL + single writer)       â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Component Statistics

| Layer | Components | Lines of Code* | Responsibilities |
|-------|------------|---------------|-----------------|
| **ğŸ”µ Core** | 1 | ~200 | API, orchestration, lifecycle |
| **ğŸŸ£ Processing** | 1 | ~150 | Batching, buffering, organization |
| **ğŸŸ¢ Kafka Ops** | 1 | ~80 | Thread pool execution, produce_batch |
| **ğŸŸ  Timeout** | 1 | ~100 | Activity monitoring, auto-flush |
| **ğŸ”´ Callbacks** | 2 | ~120 | Execution + pooling (unified) |
| **ğŸŸ¡ Data** | 2 | ~30 | Value objects, factory functions |
| **ğŸ“Š Total** | **8** | **~680** | **Clean, focused responsibilities** |

*Approximate lines excluding comments and docstrings

---

*This visual architecture demonstrates a production-ready, scalable async Kafka producer with clear separation of concerns, optimal performance characteristics, and maintainable design patterns.*
