version: v1.0
name: publish-test-pypi
agent:
  machine:
    type: s1-prod-ubuntu24-04-amd64-1
blocks:
#  - name: "Publish to Test PyPI"
#    dependencies: []
#    task:
#      jobs:
#        - name: Upload
#          commands:
#            - checkout
#            - . vault-setup
#            - export TWINE_USERNAME=__token__
#            - export TWINE_PASSWORD="$(vault kv get -format=json v1/ci/kv/pypi/test.pypi.org | jq -r '.data.data."confluent-kafka"')"
#            - sem-version python 3.11
#            - pip install twine
#            - artifact pull workflow artifacts
#            - cd artifacts
#            - ls *.tgz |xargs -n1 tar -xvf
#            - cp sdist/*.tar.gz wheelhouse/ 2>/dev/null || true
#            - twine upload --repository-url https://test.pypi.org/legacy/ --non-interactive wheelhouse/*
  - name: "Verify Test PyPI Release"
    dependencies: []
    task:
      jobs:
        - name: Verify
          commands:
            - checkout
            - sem-version python 3.11
            - tools/test-released-wheels.sh 2.13.2.dev1 test
#promotions:
#  - name: "Publish to PyPI"
#    pipeline_file: publish-pypi.yml