version: v1.0
name: build-test-release
agent:
  machine:
    type: s1-prod-ubuntu24-04-amd64-1
blocks:
  - name: "Verify Test PyPI Access"
    task:
      agent:
        machine:
          type: s1-prod-ubuntu24-04-amd64-1
      jobs:
        - name: Verify
          commands:
            - checkout
            - vault-setup
            - . vault-sem-get-secret v1/ci/kv/pypi/test.pypi.org
            - sem-version python 3.11
            - pip install twine build
            - echo "TWINE_USERNAME is set - $([ -n \"$TWINE_USERNAME\" ] && echo yes || echo no)"
            - echo "TWINE_PASSWORD is set - $([ -n \"$TWINE_PASSWORD\" ] && echo yes || echo no)"
            - python3 -m build -s
            - twine check dist/*
            - echo "Vault setup and twine check passed"